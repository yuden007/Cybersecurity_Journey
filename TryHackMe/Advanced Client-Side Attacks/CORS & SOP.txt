__________________________________________________________________________________________


TASK 2 Understanding SOP

The Same-Origin Policy (SOP) blocks scripts from accessing data on another page unless protocol, hostname, and port all match.

Examples of SOP

    Same domain, different port: https://test.com:80 can access https://test.com:80/about, but not https://test.com:8080.
    HTTP/HTTPS: http://test.com cannot access https://test.com due to different protocols.

Common Misconceptions

    SOP applies to more than just scripts—it affects images, stylesheets, and frames too.
    SOP doesn't block all cross-origin actions; techniques like CORS and postMessage allow some.
    Same domain ≠ same origin; protocol and port must also match.

SOP Decision Process

    Browsers check protocol, hostname, and port. If all match, access is allowed; otherwise, it's blocked.

__________________________________________________________________________________________


TASK 3 Understanding CORS

Cross-Origin Resource Sharing (CORS) is a system using HTTP headers that lets servers specify which origins can access their resources. 
While the Same-Origin Policy (SOP) blocks cross-origin requests by default, CORS allows controlled exceptions. 
The server sends CORS headers in its response, and the browser enforces access based on these rules.

Different HTTP Headers Involved in CORS

    Access-Control-Allow-Origin     : Specifies allowed domains.
    Access-Control-Allow-Methods    : Allowed HTTP methods.
    Access-Control-Allow-Headers    : Allowed request headers.
    Access-Control-Max-Age          : Caches preflight response.
    Access-Control-Allow-Credentials: Allows credentials (cookies, etc.) if true; cannot use * for origin.

Common Scenarios Where CORS is Applied

    APIs                        : Frontend on one domain accessing an API on another.
    CDNs                        : Loading scripts, fonts, or assets from external sources.
    Web Fonts                   : Sharing fonts across domains.
    Third-Party Widgets         : Embedding social buttons or chat plugins.
    Cross-domain Authentication : SSO or OAuth flows.

Simple Requests vs. Preflight Requests

    Simple Requests:    Use GET, HEAD, or POST with standard Content-Types and no custom headers. 
                        Sent directly with the Origin header; browser enforces CORS based on the server's Access-Control-Allow-Origin response.
    Preflight Requests: For other methods, custom headers, or non-standard Content-Types, the browser first sends an OPTIONS request (the "preflight") to check if the server allows the actual request. 
                        If allowed, the real request follows.

Process of a CORS Request

    The browser first sends an HTTP request to the server.
    The server then checks the Origin header against its list of allowed origins.
    If the origin is allowed, the server responds with the appropriate Access-Control-Allow-Origin header.
    The browser will block the cross-origin request if the origin is not allowed.

__________________________________________________________________________________________


TASK 4 ACAO in depth

The Access-Control-Allow-Origin (ACAO) header tells browsers which origins can access a resource. 
When a cross-origin request is made, the server checks the Origin and, if allowed, responds with the ACAO header specifying the permitted origin or * for any origin.

ACAO Configurations

    Single Origin:
        Access-Control-Allow-Origin: https://example.com
        Only https://example.com can access.

    Multiple Origins:
        Dynamically set ACAO for allowed origins.
        Allows a specific list of trusted origins.

    Wildcard:
        Access-Control-Allow-Origin: *
        Any origin can access (least secure).

    With Credentials:
        ACAO must be a specific origin + Access-Control-Allow-Credentials: true
        Allows cookies/auth data in cross-origin requests.

ACAO Flow

    Server checks if the request has an Origin header. 
    If not, it sets ACAO to *. 
    If present, it allows the origin only if it's in the allowed list; otherwise, access is denied.

__________________________________________________________________________________________


TASK 5 Common Misconfigurations

Common CORS misconfigurations include:

Accepting 'null' origins           :    This allows requests from local files or data URLs, which can be abused by attackers. 
                                        Always reject 'null' unless explicitly needed.
Weak origin validation (bad regex) :    Poorly written regex can match unintended domains (e.g., /example.com$/ matches badexample.com). 
                                        Use strict, tested patterns.
Reflecting arbitrary Origin headers:    Echoing back any Origin in Access-Control-Allow-Origin lets any site access protected resources. 
                                        Only allow trusted origins from a defined allowlist.

Secure Handling of Origin Checks

    A secure CORS handling flow: 
        Reject 'null' origins, check if the origin is in an allowlist, and only set Access-Control-Allow-Origin if allowed. 
        Otherwise, deny the request. This reduces CORS risks. 

Note: Using * is safe only for public, non-sensitive resources without credentials.

__________________________________________________________________________________________


TASK 5 Common Misconfigurations

CORS misconfigurations can expose web applications to attacks. Common issues include:

    Accepting 'null' origins
        Allows requests from local files or data URLs, which attackers can exploit. 
        Always reject 'null' unless required.

    Weak origin validation (bad regex)
        Poorly written regex can match unintended domains (e.g., /example.com$/ matches badexample.com). 
        Use strict, tested patterns.

    Reflecting arbitrary Origin headers
        Echoing any Origin in Access-Control-Allow-Origin lets any site access resources. 
        Only allow trusted origins from a defined allowlist.

Secure Handling of Origin Checks

    It first checks if the origin is 'null' and rejects such requests. 
    If not, it checks whether the origin is in a predefined allowlist. 
    If the origin is in the allowlist, the server sets Access-Control-Allow-Origin to the origin and proceeds with the request. 
    Otherwise, it rejects the request, ensuring only allowlisted origins are allowed. 
    This method minimizes the risk of CORS-related vulnerabilities.

Note :  "Security" in CORS depends on context. 
        Using an allowlist and rejecting unspecified origins is safer for sensitive resources. 
        However, setting Access-Control-Allow-Origin to * is acceptable for public, non-sensitive resources that do not use credentials.

__________________________________________________________________________________________


TASK 





__________________________________________________________________________________________


TASK 




__________________________________________________________________________________________

TASK

__________________________________________________________________________________________


TASK 5 Saving the output

Save Nmap scan results to a file using formats like Normal, Grepable, or XML. 

Normal

    Save scan results in normal format using -oN FILENAME. Example:
           
        /*************************************************************************************
        * pentester@TryHackMe$ cat MACHINE_IP_scan.nmap 
        * # Nmap 7.60 scan initiated Fri Sep 10 05:14:19 2021 as: nmap -sS -sV -O -oN MACHINE_IP_scan 10.48.152.80
        * Nmap scan report for 10.48.152.80
        * Host is up (0.00086s latency).
        * Not shown: 994 closed ports
        * PORT    STATE SERVICE VERSION
        * 22/tcp  open  ssh     OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)
        * 25/tcp  open  smtp    Postfix smtpd
        * 80/tcp  open  http    nginx 1.6.2
        * 110/tcp open  pop3    Dovecot pop3d
        * 111/tcp open  rpcbind 2-4 (RPC #100000)
        * 143/tcp open  imap    Dovecot imapd
        * MAC Address: 02:A0:E7:B5:B6:C5 (Unknown)
        * Device type: general purpose
        * Running: Linux 3.X
        * OS CPE: cpe:/o:linux:linux_kernel:3.13
        * OS details: Linux 3.13
        * Network Distance: 1 hop
        * Service Info: Host:  debra2.thm.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel
        *
        * OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
        * # Nmap done at Fri Sep 10 05:14:28 2021 -- 1 IP address (1 host up) scanned in 9.99 seconds
        *************************************************************************************/

Grepable

    The grepable format (-oG FILENAME) condenses results for easy filtering with tools like grep, but is less readable than normal output.

        /*************************************************************************************
        * pentester@TryHackMe$ cat MACHINE_IP_scan.gnmap 
        * # Nmap 7.60 scan initiated Fri Sep 10 05:14:19 2021 as: nmap -sS -sV -O -oG MACHINE_IP_scan 10.48.152.80
        * Host: 10.48.152.80	Status: Up
        * Host: 10.48.152.80	Ports: 22/open/tcp//ssh//OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)/, 25/open/tcp//smtp//Postfix smtpd/, 80/open/tcp//http//nginx 1.6.2/, 110/open/tcp//pop3//Dovecot pop3d/, 111/open/tcp//rpcbind//2-4 (RPC #100000)/, 143/open/tcp//imap//Dovecot imapd/	Ignored State: closed (994)	OS: Linux 3.13	Seq Index: 257	IP ID Seq: All zeros
        * # Nmap done at Fri Sep 10 05:14:28 2021 -- 1 IP address (1 host up) scanned in 9.99 seconds
        *************************************************************************************/

    Using grep on normal output lacks the host's IP, e.g., "80/tcp open http nginx 1.6.2," making it less useful for multiple scans. 
    Grepable output includes the IP, providing complete information per line.
            
        /*************************************************************************************
        * pentester@TryHackMe$ grep http MACHINE_IP_scan.gnmap 
        * Host: 10.48.152.80	Ports: 22/open/tcp//ssh//OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)/, 25/open/tcp//smtp//Postfix smtpd/, 80/open/tcp//http//nginx 1.6.2/, 110/open/tcp//pop3//Dovecot pop3d/, 111/open/tcp//rpcbind//2-4 (RPC #100000)/, 143/open/tcp//imap//Dovecot imapd/	Ignored State: closed (994)	OS: Linux 3.13	Seq Index: 257	IP ID Seq: All zeros
        *************************************************************************************/

XML
    The third format is XML, saved with -oX FILENAME. 
    Use -oA FILENAME to save in all three formats: normal, grepable, and XML.

__________________________________________________________________________________________




Appendix:
